# $Id$


#export SCALA_HOME=/Users/tarq/Downloads/scala-trunk/build/pack/
#export PATH=$SCALA_HOME/bin:$PATH

#clear

echo === compiling plugin

mkdir -p target/classes
mkdir -p target/test-classes

fsc -d target/classes -cp $SCALA_HOME/classes/compiler/ src/*.scala

jar cf target/selectivecps.jar -C misc/ scalac-plugin.xml -C target/classes .


echo === compiling test code using plugin

#scalac	-Xplugin:target/selectivecps.jar \

/Users/tarq/Downloads/scala-trunk/build/quick/bin/scalac -Xplugin:target/selectivecps.jar \
	-Xprint:typer \
	-Ylog:selectiveanf \
	-Xprint:selectiveanf \
	-Ycheck:selectiveanf \
	-Ylog:selectivecps \
	-Xprint:selectivecps \
	-Ycheck:selectivecps \
	-d target/test-classes \
	-cp target/classes \
	test-src/$@.scala
#	test-src/Library.scala test-src/$@.scala

#	-Xprint-types \
#	-explaintypes \
#	-Xprint:selectiveanf \
#	-Xprint:selectivecps \
#	-Yshow-trees \
#	-Ybrowse:selectivecps \
#   -Ycheck:superaccessors \

#scalac	-Xplugin:target/selectivecps.jar -d target/test-classes test-src/Library.scala test-src/Test4.scala




echo === running compiled test code

scala -cp $SCALA_HOME/classes/compiler/:target/test-classes/ "$@"
